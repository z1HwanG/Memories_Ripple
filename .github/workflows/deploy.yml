name: Deploy to VPS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: 'latest'
          
      - name: Build
        run: hugo --minify
          
      - name: Deploy to VPS
        uses: easingthemes/ssh-deploy@main
        env:
          # 托管在Github里的远程VPS服务器.ssh文件下的私钥id_rsa
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY_BJ_IPC }}
          # rsync的同步命令参数
          ARGS: "-avzr --delete"
          # Github workplace里生成的静态文件目录，即需要同步到远端VPS的文件/文件夹。
          SOURCE: "./public/"
          # VPS IP地址。也可以如同id_rsa私钥一样，托管在Github，然后采用动态参数，比如${{ secrets.SSH_IP }}
          REMOTE_HOST: z1hwang.cn
          # VPS默认用户名root。
          REMOTE_USER: root
          # 需要同步到的VPS目录
          TARGET: /opt/1panel/apps/openresty/openresty/www/sites/blog.z1hwang.cn/index